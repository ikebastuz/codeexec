<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Go Code Exec</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="bg-white shadow-lg rounded-lg p-8 w-full max-w-2xl">
      <h1 class="text-3xl font-bold mb-6 text-center">Run Code</h1>
      <form id="code-form" class="space-y-4">
        <div>
          <label for="language" class="block font-medium mb-1">Language:</label>
          <select
            name="language"
            id="language"
            class="w-full border rounded px-3 py-2"
          >
            {{range .Languages}}
            <option value="{{.}}">{{.}}</option>
            {{end}}
          </select>
        </div>
        <div>
          <label for="code" class="block font-medium mb-1">Code:</label>
          <textarea
            name="code"
            id="code"
            rows="12"
            class="w-full font-mono border rounded px-3 py-2 text-sm resize-y"
            placeholder="Write your code here..."
          ></textarea>
        </div>
        <div class="flex justify-center">
          <button
            id="run-btn"
            type="submit"
            class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded shadow transition disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Run
          </button>
        </div>
      </form>
      <div id="output-section" class="mt-8">
        <div class="flex items-center justify-center mb-2">
          <h2 class="text-xl font-semibold text-center mr-3">Output</h2>
          <span
            id="duration"
            class="text-xs text-gray-500 bg-gray-200 rounded px-2 py-1"
            style="display: none"
          ></span>
        </div>
        <div class="mb-4">
          <label class="block font-medium mb-1 text-green-700">Stdout:</label>
          <pre
            id="stdout"
            class="bg-gray-100 border border-green-200 rounded p-3 text-sm overflow-x-auto whitespace-pre-wrap text-green-800"
          ></pre>
        </div>
        <div>
          <label class="block font-medium mb-1 text-red-700">Stderr:</label>
          <pre
            id="stderr"
            class="bg-gray-100 border border-red-200 rounded p-3 text-sm overflow-x-auto whitespace-pre-wrap text-red-800"
          ></pre>
        </div>
        <div
          id="error-section"
          class="mt-2 text-center text-red-600 font-semibold"
        ></div>
      </div>
    </div>
    <script>
      window.sampleCodeMap = JSON.parse("{{ .SampleCodeMap }}");

      const languageSelect = document.getElementById("language");
      const codeTextarea = document.getElementById("code");
      const runBtn = document.getElementById("run-btn");
      const durationElem = document.getElementById("duration");

      function setSampleCode() {
        const lang = languageSelect.value;
        if (window.sampleCodeMap[lang]) {
          codeTextarea.value = window.sampleCodeMap[lang];
        } else {
          codeTextarea.value = "";
        }
      }

      document
        .getElementById("code-form")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          runBtn.disabled = true;
          runBtn.textContent = "Running...";
          const form = e.target;
          const data = new FormData(form);
          const resp = await fetch("/run", {
            method: "POST",
            headers: { Accept: "application/json" },
            body: data,
          });
          const result = await resp.json();
          document.getElementById("stdout").textContent = result.stdout || "";
          document.getElementById("stderr").textContent = result.stderr || "";
          document.getElementById("error-section").textContent =
            result.error || "";

          if (typeof result.duration === "number") {
            durationElem.textContent = `${result.duration.toFixed(2)}s`;
            durationElem.style.display = "inline-block";
          } else {
            durationElem.textContent = "";
            durationElem.style.display = "none";
          }
          runBtn.disabled = false;
          runBtn.textContent = "Run";
        });

      languageSelect.addEventListener("change", setSampleCode);
      setSampleCode();
    </script>
  </body>
</html>
